<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//TEST_AMDTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.server.model.dao.admin.AdminMapper">
    <select id="viewEmp" resultType="User">
        SELECT username, E.name as name, email, gender, position, working_status as workingStatus, img, role, qr_path as qrPath, dep_id as depId, D.name as department, location, created_at as createdAt
        FROM EMPLOYEE E INNER JOIN DEPARTMENT D
       ON E.dep_id = D.id;

    </select>

    <select id="viewEmpDetail" resultType="User">
        select * from (select e.name, d.name as department, e.position, e.email, d.location, e.qr_path, e.img
                       from (SELECT name, dep_id, position, email, qr_path, img from EMPLOYEE where username = #{username}) e
                                JOIN DEPARTMENT d ON e.dep_id = d.id) a
                          CROSS JOIN (select i.name as manager from EMPLOYEE i where dep_id IN (SELECT dep_id from EMPLOYEE where username = #{username}) and role = '1') b;
    </select>

    <insert id="insertEmp"  parameterType="User" >
        INSERT INTO EMPLOYEE (username, dep_id,  name, password, email, img, gender, position, role, qr_path , working_status)
        values (#{username}, #{depId}, #{name}, #{password}, #{email}, #{img}, #{gender}, #{position}, #{role}, #{qrPath}, #{workingStatus});
    </insert>

    <update id="deleteEmp">
        UPDATE EMPLOYEE
        SET working_status = 1
        WHERE username = #{username};
    </update>

    <update id="updateEmp">
        UPDATE EMPLOYEE
        SET (#{username}, #{depId}, #{name}, #{password}, #{email}, #{img}, #{gender}, #{position}, #{role}, #{qrPath}
        WHERE username = #{username};
    </update>

</mapper>